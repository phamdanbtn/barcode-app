<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Tạo Barcode Hàng Loạt - Code 128</title>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<style>
body {
    font-family: Arial;
    padding: 30px;
}
textarea {
    width: 400px;
    height: 200px;
}
.barcode-item {
    margin: 20px 0;
    border-bottom: 1px dashed #ccc;
    padding-bottom: 15px;
}
button {
    padding: 10px 20px;
    margin-top: 10px;
}
</style>
</head>

<body>

<h2>Tạo Barcode Code 128 Hàng Loạt</h2>

<p>Mỗi dòng là 1 barcode:</p>

<textarea id="inputData" placeholder="SP001
SP002
SP003"></textarea>
<br>

<button onclick="generateBarcodes()">Tạo barcode</button>

<div id="barcodeContainer"></div>

<script>
function generateBarcodes() {
    const container = document.getElementById("barcodeContainer");
    container.innerHTML = "";

    const lines = document.getElementById("inputData")
        .value
        .split("\n")
        .map(line => line.trim())
        .filter(line => line !== "");

    lines.forEach((value, index) => {
        const div = document.createElement("div");
        div.className = "barcode-item";

        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        const id = "barcode_" + index;
        svg.setAttribute("id", id);

        const btn = document.createElement("button");
        btn.innerText = "Tải PNG";
        btn.onclick = () => downloadPNG(id, value);

        div.appendChild(svg);
        div.appendChild(document.createElement("br"));
        div.appendChild(btn);

        container.appendChild(div);

        JsBarcode("#" + id, value, {
            format: "CODE128",
            width: 2,
            height: 80,
            displayValue: true
        });
    });
}

function downloadPNG(svgId, filename) {
    const svg = document.getElementById(svgId);
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    const svgData = new XMLSerializer().serializeToString(svg);
    const img = new Image();

    img.onload = function () {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        const link = document.createElement("a");
        link.download = filename + ".png";
        link.href = canvas.toDataURL("image/png");
        link.click();
    };

    img.src = "data:image/svg+xml;base64," + btoa(svgData);
}
</script>

</body>
</html>
